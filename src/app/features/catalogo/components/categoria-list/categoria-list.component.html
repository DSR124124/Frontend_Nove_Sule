<div class="categoria-list-container">
  <!-- Diálogo de confirmación -->
  <p-confirmDialog></p-confirmDialog>
  <!-- Header con acciones -->
  <div class="list-header">
    <div class="header-left">
      <h2 class="heading-2">Lista de Categorías</h2>
      <span class="text-caption">{{totalElements}} categorías</span>
    </div>
    <div class="header-actions">
      <p-button
        (onClick)="onRefresh()"
        [disabled]="loading"
        label="Actualizar"
        icon="fas fa-sync-alt"
        styleClass="btn-secondary btn-outlined btn-sm"
        [loading]="loading">
      </p-button>
      <p-button
        routerLink="/catalogo/categorias/nuevo"
        label="Nueva Categoría"
        icon="fas fa-plus"
        styleClass="btn-primary btn-sm">
      </p-button>
    </div>
  </div>

  <!-- Panel de búsqueda y filtros -->
  <p-panel
    header="Búsqueda y Filtros"
    [toggleable]="true"
    [collapsed]="true"
    styleClass="filters-panel">
    <ng-template pTemplate="header">
      <div class="panel-header">
        <i class="fas fa-search"></i>
        <span>Búsqueda y Filtros</span>
        <i class="fas fa-chevron-down"></i>
      </div>
    </ng-template>

    <!-- Filtros -->
    <div class="filters-content">
      <div class="filters-row">
        <div class="input-group">
          <label for="nombre" class="input-label">Nombre:</label>
          <input
            type="text"
            id="nombre"
            [(ngModel)]="filtros.nombre"
            placeholder="Buscar por nombre..."
            class="input-text">
        </div>

        <div class="input-group">
          <label for="estado" class="input-label">Estado:</label>
          <p-select
            id="estado"
            [(ngModel)]="filtros.estado"
            [options]="estadoOptions"
            optionLabel="label"
            optionValue="value"
            placeholder="Seleccionar estado"
            [showClear]="true"
            styleClass="w-full">
          </p-select>
        </div>

        <div class="filter-actions">
          <p-button
            (onClick)="onSearch()"
            [disabled]="loading"
            label="Buscar"
            icon="fas fa-search"
            styleClass="btn-primary btn-sm">
          </p-button>
          <p-button
            (onClick)="onClearSearch()"
            [disabled]="loading"
            label="Limpiar"
            icon="fas fa-times"
            styleClass="btn-secondary btn-outlined btn-sm">
          </p-button>
        </div>
      </div>
    </div>
  </p-panel>

  <!-- Loading -->
  <div class="loading-container" *ngIf="loading">
    <p-progressSpinner [style]="{'width': '50px', 'height': '50px'}" styleClass="custom-spinner"
      ariaLabel="Cargando categorías">
    </p-progressSpinner>
    <p class="text-body">Cargando categorías...</p>
  </div>

  <!-- Tabla de categorías -->
  <p-table
    [value]="categorias"
    [loading]="loading"
    [paginator]="totalElements > pageSize"
    [rows]="pageSize"
    [totalRecords]="totalElements"
    [first]="currentPage * pageSize"
    (onPage)="onPageChange($event)"
    styleClass="p-datatable-sm categories-table"
    [rowHover]="true"
    [showCurrentPageReport]="true"
    currentPageReportTemplate="Mostrando {first} a {last} de {totalRecords} categorías"
    dataKey="id">

    <!-- Columnas de la tabla -->
    <ng-template pTemplate="header">
      <tr>
        <th style="width: 3rem">ID</th>
        <th>Nombre</th>
        <th style="width: 20rem">Descripción</th>
        <th style="width: 6rem">Color</th>
        <th style="width: 4rem">Orden</th>
        <th style="width: 6rem">Estado</th>
        <th style="width: 8rem">Acciones</th>
      </tr>
    </ng-template>

    <ng-template pTemplate="body" let-categoria>
      <tr>
        <td>
          <span class="text-caption">{{categoria.id}}</span>
        </td>
        <td>
          <div class="categoria-info">
            <div class="categoria-name">{{categoria.nombre}}</div>
            <div class="categoria-image" *ngIf="categoria.imagen">
              <img [src]="categoria.imagen" [alt]="categoria.nombre" class="categoria-img">
            </div>
          </div>
        </td>
        <td>
          <span class="text-body" *ngIf="categoria.descripcion">
            {{categoria.descripcion | slice:0:80}}{{categoria.descripcion.length > 80 ? '...' : ''}}
          </span>
          <span class="text-muted" *ngIf="!categoria.descripcion">Sin descripción</span>
        </td>
        <td>
          <div class="color-preview" *ngIf="categoria.color" [style.background-color]="categoria.color">
            <span class="color-text">{{categoria.color}}</span>
          </div>
          <span class="text-muted" *ngIf="!categoria.color">Sin color</span>
        </td>
        <td>
          <span class="text-body">{{categoria.orden || '-'}}</span>
        </td>
        <td>
          <p-tag
            [value]="getEstadoText(categoria.estado)"
            [styleClass]="getEstadoStyleClass(categoria.estado)"
            [rounded]="true">
          </p-tag>
        </td>
        <td>
          <div class="table-actions">
            <p-button
              icon="pi pi-pencil"
              styleClass="btn-primary btn-outlined btn-sm p-button-icon-only"
              pTooltip="Editar categoría"
              tooltipPosition="top"
              [routerLink]="['/catalogo/categorias/editar', categoria.id]">
            </p-button>
            <p-button
              (onClick)="onCambiarEstado(categoria)"
              [icon]="categoria.estado === 'ACTIVO' ? 'pi pi-pause' : 'pi pi-play'"
              [styleClass]="categoria.estado === 'ACTIVO' ? 'btn-warning btn-outlined btn-sm p-button-icon-only' : 'btn-success btn-outlined btn-sm p-button-icon-only'"
              [pTooltip]="categoria.estado === 'ACTIVO' ? 'Desactivar categoría' : 'Activar categoría'"
              tooltipPosition="top">
            </p-button>
            <p-button
              (onClick)="onEliminar(categoria)"
              icon="pi pi-trash"
              styleClass="btn-danger btn-outlined btn-sm p-button-icon-only"
              pTooltip="Eliminar categoría"
              tooltipPosition="top">
            </p-button>
          </div>
        </td>
      </tr>
    </ng-template>

    <ng-template pTemplate="emptymessage">
      <tr>
        <td colspan="7" class="text-center">
          <div class="no-categories-content">
            <i class="fas fa-folder-open text-6xl text-muted"></i>
            <h3 class="heading-3">No hay categorías</h3>
            <p class="text-body">No se encontraron categorías con los filtros aplicados.</p>
            <p-button
              (onClick)="onClearSearch()"
              label="Limpiar Filtros"
              icon="fas fa-refresh"
              styleClass="btn-primary btn-sm">
            </p-button>
          </div>
        </td>
      </tr>
    </ng-template>
  </p-table>
</div>
