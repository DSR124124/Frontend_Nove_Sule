<p-toolbar>
  <ng-template pTemplate="left">
    <p-inputgroup>
      <input pInputText placeholder="Buscar productos..." (input)="onFilterGlobal($event, globalFilter)" #globalFilter />
      <p-inputgroup-addon>
        <p-button icon="pi pi-search" severity="secondary" variant="text" (click)="onFilterGlobal($event, globalFilter)" />
      </p-inputgroup-addon>
    </p-inputgroup>
  </ng-template>
  <ng-template pTemplate="right">
    <div class="d-flex gap-2 align-items-center flex-wrap">
      <div class="d-flex align-items-center gap-2">
        <label for="dias" class="fw-semibold text-nowrap">Días:</label>
        <p-inputNumber
          id="dias"
          [(ngModel)]="dias"
          (onInput)="onDiasChange()"
          [min]="1"
          [max]="365"
          placeholder="30"
          [showButtons]="true"
          [suffix]="' días'"
          styleClass="w-auto">
        </p-inputNumber>
      </div>
      <div class="d-flex gap-2">
        <p-button
          label="Actualizar"
          icon="pi pi-refresh"
          (onClick)="cargarProductosProximosVencer()"
          [loading]="isLoading"
          [disabled]="isLoading"
          styleClass="btn btn-primary btn-sm btn-outlined">
        </p-button>
        <p-button
          label="Excel"
          icon="pi pi-file-excel"
          (onClick)="exportarExcel()"
          styleClass="btn btn-success btn-sm btn-outlined">
        </p-button>
        <p-button
          label="PDF"
          icon="pi pi-file-pdf"
          (onClick)="exportarPDF()"
          styleClass="btn btn-danger btn-sm btn-outlined">
        </p-button>
      </div>
    </div>
  </ng-template>
</p-toolbar>

<div class="container-fluid">

  <!-- Data Table Card -->
  <p-card>
    <ng-template pTemplate="body">
      <p-table
        [value]="productos"
        [paginator]="true"
        [rows]="10"
        [showCurrentPageReport]="true"
        currentPageReportTemplate="Mostrando {first} a {last} de {totalRecords} productos"
        [rowsPerPageOptions]="[10, 25, 50]"
        [globalFilterFields]="['productoNombre', 'productoCodigo']"
        styleClass="p-datatable-sm"
        #dt>

        <ng-template pTemplate="header">
          <tr>
            <th class="text-center">Código</th>
            <th>Producto</th>
            <th class="text-center">Stock Actual</th>
            <th class="text-center d-none d-md-table-cell">Stock Mín.</th>
            <th class="text-center d-none d-lg-table-cell">Stock Máx.</th>
            <th class="text-center">Estado</th>
            <th class="text-end d-none d-xl-table-cell">Valor Inventario</th>
            <th class="text-center d-none d-lg-table-cell">Entradas</th>
            <th class="text-center d-none d-lg-table-cell">Salidas</th>
            <th class="d-none d-xl-table-cell">Último Movimiento</th>
            <th class="text-end d-none d-xl-table-cell">Precio Prom.</th>
            <th class="text-center d-none d-lg-table-cell">Mov. Mes</th>
          </tr>
        </ng-template>

        <ng-template pTemplate="body" let-producto>
          <tr>
            <td class="text-center">
              <code class="fw-bold text-primary">{{ producto.productoCodigo }}</code>
            </td>
            <td>
              <div>
                <div class="fw-semibold text-dark">{{ producto.productoNombre }}</div>
                <small class="text-muted d-md-none d-lg-none d-xl-none d-block">
                  Stock: {{ producto.stockActual }} | Estado: {{ producto.estadoStock }}
                </small>
              </div>
            </td>
            <td class="text-center">
              <span class="fw-bold">{{ producto.stockActual }}</span>
            </td>
            <td class="text-center text-muted d-none d-md-table-cell">{{ producto.stockMinimo }}</td>
            <td class="text-center text-muted d-none d-lg-table-cell">{{ producto.stockMaximo }}</td>
            <td class="text-center">
              <p-tag
                [value]="producto.estadoStock"
                [styleClass]="getSeverityClass(producto.estadoStock)">
              </p-tag>
            </td>
            <td class="text-end d-none d-xl-table-cell">{{ formatCurrency(producto.valorInventario) }}</td>
            <td class="text-center d-none d-lg-table-cell">{{ producto.totalEntradas }}</td>
            <td class="text-center d-none d-lg-table-cell">{{ producto.totalSalidas }}</td>
            <td class="d-none d-xl-table-cell">
              <small class="text-muted">{{ formatDate(producto.fechaUltimoMovimiento) }}</small>
            </td>
            <td class="text-end d-none d-xl-table-cell">{{ formatCurrency(producto.precioPromedio) }}</td>
            <td class="text-center d-none d-lg-table-cell">{{ producto.movimientosMes }}</td>
          </tr>
        </ng-template>

        <ng-template pTemplate="emptymessage">
          <tr>
            <td colspan="12" class="text-center py-5">
              <div class="d-flex flex-column align-items-center">
                <p-avatar icon="pi pi-clock" styleClass="bg-light text-muted mb-3" size="xlarge"></p-avatar>
                <h6 class="text-muted mb-2">No se encontraron productos</h6>
                <small class="text-muted">No hay productos próximos a vencer en {{ dias }} días</small>
              </div>
            </td>
          </tr>
        </ng-template>
      </p-table>
    </ng-template>
  </p-card>
</div>


