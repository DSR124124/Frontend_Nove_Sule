<div class="resumen-general">
  <!-- ============================= -->
  <!-- FILTERS SECTION -->
  <!-- ============================= -->
  <div class="resumen-general__filters">
    <p-card styleClass="resumen-general__filters-card mb-4">
      <ng-template pTemplate="header">
        <div class="resumen-general__card-header">
          <p-avatar icon="pi pi-filter" styleClass="mr-2"></p-avatar>
          <span>Filtros y Acciones</span>
        </div>
      </ng-template>

      <div class="p-grid p-align-end">
        <div class="p-col-12 p-md-4">
          <label for="fecha" class="block mb-2">Fecha de Consulta</label>
          <input
            type="date"
            id="fecha"
            [(ngModel)]="fechaInput"
            (change)="onFechaChange()"
            class="p-inputtext p-component w-full"
            pInputText>
        </div>

        <div class="p-col-12 p-md-4">
          <p-button
            label="Actualizar"
            icon="pi pi-refresh"
            (onClick)="cargarResumenGeneral()"
            [loading]="loading"
            styleClass="p-button-primary w-full">
          </p-button>
        </div>

        <div class="p-col-12 p-md-4">
          <p-button
            label="Exportar PDF"
            icon="pi pi-file-pdf"
            styleClass="p-button-outlined w-full"
            (onClick)="exportarPDF()">
          </p-button>
        </div>
      </div>
    </p-card>
  </div>

  <!-- ============================= -->
  <!-- MAIN CONTENT -->
  <!-- ============================= -->
  <div class="resumen-general__content" *ngIf="resumenGeneral && !loading">

    <!-- ============================= -->
    <!-- METRICS SECTION -->
    <!-- ============================= -->
    <div class="resumen-general__metrics">
      <p-card styleClass="resumen-general__metrics-panel mb-4">
        <ng-template pTemplate="header">
          <div class="resumen-general__card-header">
            <p-avatar icon="pi pi-chart-line" styleClass="mr-2"></p-avatar>
            <span>Métricas Principales</span>
          </div>
        </ng-template>

        <div class="p-grid">
          <!-- Total Productos -->
          <div class="p-col-12 p-md-6 p-lg-3">
            <div class="resumen-general__metric resumen-general__metric--primary">
              <div class="resumen-general__metric-icon">
                <p-avatar icon="pi pi-box" size="xlarge"></p-avatar>
              </div>
              <div class="resumen-general__metric-content">
                <div class="resumen-general__metric-value">{{resumenGeneral.totalProductos}}</div>
                <div class="resumen-general__metric-label">Total Productos</div>
              </div>
            </div>
          </div>

          <!-- Stock Bajo -->
          <div class="p-col-12 p-md-6 p-lg-3">
            <div class="resumen-general__metric resumen-general__metric--warning">
              <div class="resumen-general__metric-icon">
                <p-avatar icon="pi pi-exclamation-triangle" size="xlarge"></p-avatar>
              </div>
              <div class="resumen-general__metric-content">
                <div class="resumen-general__metric-value">{{resumenGeneral.productosConStockBajo}}</div>
                <div class="resumen-general__metric-label">Stock Bajo</div>
                <p-tag
                  [value]="getSeverityText((resumenGeneral.productosConStockBajo / resumenGeneral.totalProductos) * 100)"
                  [styleClass]="getSeverityClass((resumenGeneral.productosConStockBajo / resumenGeneral.totalProductos) * 100)">
                </p-tag>
              </div>
            </div>
          </div>

          <!-- Próximos a Vencer -->
          <div class="p-col-12 p-md-6 p-lg-3">
            <div class="resumen-general__metric resumen-general__metric--info">
              <div class="resumen-general__metric-icon">
                <p-avatar icon="pi pi-clock" size="xlarge"></p-avatar>
              </div>
              <div class="resumen-general__metric-content">
                <div class="resumen-general__metric-value">{{resumenGeneral.productosProximosVencer}}</div>
                <div class="resumen-general__metric-label">Próximos a Vencer</div>
              </div>
            </div>
          </div>

          <!-- Valor Total -->
          <div class="p-col-12 p-md-6 p-lg-3">
            <div class="resumen-general__metric resumen-general__metric--success">
              <div class="resumen-general__metric-icon">
                <p-avatar icon="pi pi-wallet" size="xlarge"></p-avatar>
              </div>
              <div class="resumen-general__metric-content">
                <div class="resumen-general__metric-value resumen-general__metric-value--currency">{{formatCurrency(resumenGeneral.valorTotalInventario)}}</div>
                <div class="resumen-general__metric-label">Valor Total</div>
              </div>
            </div>
          </div>
        </div>
      </p-card>
    </div>

    <!-- ============================= -->
    <!-- STATISTICS SECTION -->
    <!-- ============================= -->
    <div class="resumen-general__statistics">
      <div class="p-grid">

        <!-- Movimientos del Mes -->
        <div class="p-col-12 p-md-6">
          <div class="resumen-general__stats-card">
            <div class="resumen-general__stats-header">
              <p-avatar icon="pi pi-arrows-v" styleClass="resumen-general__stats-avatar resumen-general__stats-avatar--movements"></p-avatar>
              <div class="resumen-general__stats-title">
                <h3>Movimientos del Mes</h3>
                <p>Entradas y Salidas</p>
              </div>
            </div>

            <div class="resumen-general__stats-content">
              <div class="p-grid">
                <div class="p-col-6">
                  <div class="resumen-general__stat-item resumen-general__stat-item--success">
                    <p-avatar icon="pi pi-arrow-up" styleClass="resumen-general__stat-avatar"></p-avatar>
                    <div class="resumen-general__stat-info">
                      <div class="resumen-general__stat-number">{{resumenGeneral.totalEntradasMes}}</div>
                      <div class="resumen-general__stat-text">Entradas</div>
                    </div>
                  </div>
                </div>

                <div class="p-col-6">
                  <div class="resumen-general__stat-item resumen-general__stat-item--danger">
                    <p-avatar icon="pi pi-arrow-down" styleClass="resumen-general__stat-avatar"></p-avatar>
                    <div class="resumen-general__stat-info">
                      <div class="resumen-general__stat-number">{{resumenGeneral.totalSalidasMes}}</div>
                      <div class="resumen-general__stat-text">Salidas</div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Estado del Inventario -->
        <div class="p-col-12 p-md-6">
          <div class="resumen-general__stats-card">
            <div class="resumen-general__stats-header">
              <p-avatar icon="pi pi-info-circle" styleClass="resumen-general__stats-avatar resumen-general__stats-avatar--info"></p-avatar>
              <div class="resumen-general__stats-title">
                <h3>Estado General</h3>
                <p>Información del Sistema</p>
              </div>
            </div>

            <div class="resumen-general__stats-content">
              <div class="resumen-general__stat-item resumen-general__stat-item--secondary">
                <p-avatar icon="pi pi-pause" styleClass="resumen-general__stat-avatar"></p-avatar>
                <div class="resumen-general__stat-info">
                  <div class="resumen-general__stat-number">{{resumenGeneral.productosSinMovimientos}}</div>
                  <div class="resumen-general__stat-text">Sin Movimientos</div>
                </div>
              </div>

              <p-divider></p-divider>

              <div class="resumen-general__update-section">
                <div class="resumen-general__update-content">
                  <p-avatar icon="pi pi-sync" styleClass="resumen-general__update-avatar"></p-avatar>
                  <div>
                    <div class="resumen-general__stat-text">Última Actualización</div>
                    <div class="resumen-general__update-date">{{formatDate(resumenGeneral.ultimaActualizacion)}}</div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

  </div>

  <!-- ============================= -->
  <!-- LOADING STATE -->
  <!-- ============================= -->
  <div class="resumen-general__loading-state" *ngIf="loading">
    <p-card styleClass="resumen-general__loading-panel text-center">
      <div class="py-6">
        <p-progressSpinner styleClass="mb-3"></p-progressSpinner>
        <h4 class="mb-2">Cargando resumen</h4>
        <p class="text-muted">Obteniendo datos del inventario...</p>
      </div>
    </p-card>
  </div>

  <!-- ============================= -->
  <!-- EMPTY STATE -->
  <!-- ============================= -->
  <div class="resumen-general__empty-state" *ngIf="!loading && !resumenGeneral">
    <p-card styleClass="resumen-general__empty-panel text-center">
      <div class="py-6">
        <p-avatar
          icon="pi pi-chart-bar"
          size="xlarge"
          styleClass="mb-3"
          [style]="{'background-color': 'var(--surface-300)', 'color': 'var(--surface-600)'}">
        </p-avatar>
        <h4 class="mb-3">No hay datos disponibles</h4>
        <p class="text-muted mb-4">
          Selecciona una fecha y presiona "Actualizar" para ver el resumen del inventario.
        </p>
        <p-button
          label="Cargar Datos"
          icon="pi pi-refresh"
          (onClick)="cargarResumenGeneral()"
          styleClass="p-button-primary">
        </p-button>
      </div>
    </p-card>
  </div>

</div>
