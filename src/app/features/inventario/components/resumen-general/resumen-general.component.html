<div class="p-fluid">
  <p-card header="Resumen General del Inventario" subHeader="Vista general del estado del inventario">

    <!-- Filtros -->
    <div class="filtros-section mb-4">
      <div class="filtros-container">
        <div class="filtro-item">
          <label for="fecha" class="form-label">Fecha de Consulta</label>
          <p-calendar
            id="fecha"
            [(ngModel)]="fechaSeleccionada"
            (onSelect)="onFechaChange()"
            placeholder="Seleccionar fecha"
            [showIcon]="true"
            class="w-100">
          </p-calendar>
        </div>
        <div class="filtro-item">
          <p-button
            label="Actualizar"
            icon="pi pi-refresh"
            (onClick)="cargarResumenGeneral()"
            [loading]="loading"
            styleClass="btn btn-primary w-100">
          </p-button>
        </div>
        <div class="filtro-item">
          <p-button
            label="Exportar PDF"
            icon="pi pi-file-pdf"
            styleClass="btn btn-export w-100"
            (onClick)="exportarPDF()">
          </p-button>
        </div>
      </div>
    </div>

        <!-- Resumen General -->
        <div *ngIf="resumenGeneral && !loading" class="resumen-section">

          <!-- Métricas Principales -->
          <div class="grid mb-4">
            <div class="col-12 md:col-3">
              <p-card class="metric-card">
                <div class="metric-content">
                  <div class="metric-icon">
                    <i class="pi pi-box" style="color: var(--primary);"></i>
                  </div>
                  <div class="metric-info">
                    <h3 class="metric-value">{{resumenGeneral.totalProductos}}</h3>
                    <p class="metric-label">Total Productos</p>
                  </div>
                </div>
              </p-card>
            </div>

            <div class="col-12 md:col-3">
              <p-card class="metric-card">
                <div class="metric-content">
                  <div class="metric-icon">
                    <i class="pi pi-exclamation-triangle" style="color: var(--error);"></i>
                  </div>
                  <div class="metric-info">
                    <h3 class="metric-value">{{resumenGeneral.productosConStockBajo}}</h3>
                    <p class="metric-label">Stock Bajo</p>
                    <p-tag
                      [value]="getSeverityText((resumenGeneral.productosConStockBajo / resumenGeneral.totalProductos) * 100)"
                      [styleClass]="getSeverityClass((resumenGeneral.productosConStockBajo / resumenGeneral.totalProductos) * 100)">
                    </p-tag>
                  </div>
                </div>
              </p-card>
            </div>

            <div class="col-12 md:col-3">
              <p-card class="metric-card">
                <div class="metric-content">
                  <div class="metric-icon">
                    <i class="pi pi-clock" style="color: var(--warning);"></i>
                  </div>
                  <div class="metric-info">
                    <h3 class="metric-value">{{resumenGeneral.productosProximosVencer}}</h3>
                    <p class="metric-label">Próximos a Vencer</p>
                  </div>
                </div>
              </p-card>
            </div>

            <div class="col-12 md:col-3">
              <p-card class="metric-card">
                <div class="metric-content">
                  <div class="metric-icon">
                    <i class="pi pi-dollar" style="color: var(--success);"></i>
                  </div>
                  <div class="metric-info">
                    <h3 class="metric-value">{{formatCurrency(resumenGeneral.valorTotalInventario)}}</h3>
                    <p class="metric-label">Valor Total</p>
                  </div>
                </div>
              </p-card>
            </div>
          </div>

          <!-- Estadísticas de Movimientos -->
          <div class="grid mb-4">
            <div class="col-12 md:col-6">
              <p-card header="Movimientos del Mes" class="stats-card">
                <div class="stats-content">
                  <div class="stat-item">
                    <div class="stat-icon">
                      <i class="pi pi-arrow-up" style="color: var(--success);"></i>
                    </div>
                    <div class="stat-info">
                      <h4 class="stat-value">{{resumenGeneral.totalEntradasMes}}</h4>
                      <p class="stat-label">Entradas</p>
                    </div>
                  </div>
                  <p-divider></p-divider>
                  <div class="stat-item">
                    <div class="stat-icon">
                      <i class="pi pi-arrow-down" style="color: var(--error);"></i>
                    </div>
                    <div class="stat-info">
                      <h4 class="stat-value">{{resumenGeneral.totalSalidasMes}}</h4>
                      <p class="stat-label">Salidas</p>
                    </div>
                  </div>
                </div>
              </p-card>
            </div>

            <div class="col-12 md:col-6">
              <p-card header="Estado del Inventario" class="stats-card">
                <div class="stats-content">
                  <div class="stat-item">
                    <div class="stat-icon">
                      <i class="pi pi-pause" style="color: var(--text-muted);"></i>
                    </div>
                    <div class="stat-info">
                      <h4 class="stat-value">{{resumenGeneral.productosSinMovimientos}}</h4>
                      <p class="stat-label">Sin Movimientos</p>
                    </div>
                  </div>
                  <p-divider></p-divider>
                  <div class="stat-item">
                    <div class="stat-icon">
                      <i class="pi pi-calendar" style="color: var(--info);"></i>
                    </div>
                    <div class="stat-info">
                      <p class="stat-label">Última Actualización</p>
                      <p class="stat-value-small">{{formatDate(resumenGeneral.ultimaActualizacion)}}</p>
                    </div>
                  </div>
                </div>
              </p-card>
            </div>
          </div>

          <!-- Alertas y Recomendaciones -->
          <div class="grid">
            <div class="col-12">
              <p-card header="Alertas y Recomendaciones" class="alerts-card">
                <div class="alerts-content">
                  <div *ngIf="resumenGeneral.productosConStockBajo > 0" class="alert alert-warning">
                    <i class="pi pi-exclamation-triangle"></i>
                    <strong>{{resumenGeneral.productosConStockBajo}} productos</strong> tienen stock bajo y requieren reposición inmediata.
                  </div>

                  <div *ngIf="resumenGeneral.productosProximosVencer > 0" class="alert alert-info">
                    <i class="pi pi-clock"></i>
                    <strong>{{resumenGeneral.productosProximosVencer}} productos</strong> están próximos a vencer y necesitan atención.
                  </div>

                  <div *ngIf="resumenGeneral.productosSinMovimientos > 0" class="alert alert-secondary">
                    <i class="pi pi-pause"></i>
                    <strong>{{resumenGeneral.productosSinMovimientos}} productos</strong> no han tenido movimientos recientes. Considere revisar su demanda.
                  </div>

                  <div *ngIf="resumenGeneral.productosConStockBajo === 0 && resumenGeneral.productosProximosVencer === 0" class="alert alert-success">
                    <i class="pi pi-check-circle"></i>
                    <strong>¡Excelente!</strong> El inventario se encuentra en buen estado sin alertas críticas.
                  </div>
                </div>
              </p-card>
            </div>
          </div>

        </div>

        <!-- Loading State -->
        <div *ngIf="loading" class="text-center p-4">
          <p-progressSpinner></p-progressSpinner>
          <p class="mt-3" style="color: var(--text-muted);">Cargando resumen general...</p>
        </div>

        <!-- Empty State -->
        <div *ngIf="!loading && !resumenGeneral" class="text-center p-4">
          <i class="pi pi-info-circle" style="font-size: 3rem; color: var(--text-muted);"></i>
          <h5 class="mt-3" style="color: var(--text-muted);">No hay datos disponibles</h5>
          <p style="color: var(--text-muted);">Seleccione una fecha y actualice para ver el resumen</p>
        </div>

    </p-card>
</div>

<p-toast></p-toast>
