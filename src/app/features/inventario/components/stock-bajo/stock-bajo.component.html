<p-toolbar>
  <ng-template pTemplate="left">

<p-inputgroup>
  <input pInputText placeholder="Buscar productos..." (input)="onFilterGlobal($event, globalFilter)" #globalFilter />
  <p-inputgroup-addon>
      <p-button icon="pi pi-search" severity="secondary" variant="text" (click)="onFilterGlobal($event, globalFilter)" />
  </p-inputgroup-addon>
</p-inputgroup>

  </ng-template>
  <ng-template pTemplate="right">
    <div class="d-flex gap-2">
      <p-button
        label="Actualizar"
        icon="pi pi-refresh"
        (onClick)="cargarProductosConStockBajo()"
        [loading]="loading"
        styleClass="btn btn-primary btn-sm btn-outlined">
      </p-button>
      <p-button
        label="Excel"
        icon="pi pi-file-excel"
        (onClick)="exportarExcel()"
        styleClass="btn btn-success btn-sm btn-outlined">
      </p-button>
      <p-button
        label="PDF"
        icon="pi pi-file-pdf"
        (onClick)="exportarPDF()"
        styleClass="btn btn-danger btn-sm btn-outlined">
      </p-button>
    </div>

  </ng-template>
</p-toolbar>

<p-divider></p-divider>

  <!-- Data Table Card -->
  <p-card>
    <ng-template pTemplate="body">
      <p-table
        [value]="productos"
        [loading]="loading"
        [paginator]="true"
        [rows]="10"
        [showCurrentPageReport]="true"
        currentPageReportTemplate="Mostrando {first} a {last} de {totalRecords} productos"
        [rowsPerPageOptions]="[10, 25, 50]"
        [globalFilterFields]="['productoNombre', 'productoCodigo', 'proveedorNombre', 'categoriaNombre']"
        styleClass="p-datatable-sm"
        #dt>

        <ng-template pTemplate="header">
          <tr>
            <th class="text-center">Código</th>
            <th>Producto</th>
            <th class="d-none d-md-table-cell">Categoría</th>
            <th class="d-none d-lg-table-cell">Proveedor</th>
            <th class="text-center">Stock Actual</th>
            <th class="text-center">Stock Mín.</th>
            <th class="text-center">Diferencia</th>
            <th class="text-center">Estado</th>
            <th class="text-end d-none d-xl-table-cell">Precio</th>
            <th class="text-end d-none d-xl-table-cell">Valor Rep.</th>
            <th class="d-none d-lg-table-cell">Ubicación</th>
          </tr>
        </ng-template>

        <ng-template pTemplate="body" let-producto>
          <tr>
            <td class="text-center">
              <code class="fw-bold text-primary">{{ producto.productoCodigo }}</code>
            </td>
            <td>
              <div>
                <div class="fw-semibold text-dark">{{ producto.productoNombre }}</div>
                <small class="text-muted d-md-none">
                  {{ producto.categoriaNombre }} | {{ producto.proveedorNombre }}
                </small>
              </div>
            </td>
            <td class="d-none d-md-table-cell">
              <span class="badge bg-light text-dark">{{ producto.categoriaNombre }}</span>
            </td>
            <td class="d-none d-lg-table-cell">{{ producto.proveedorNombre }}</td>
            <td class="text-center">
              <span class="fw-bold">{{ producto.stockActual }}</span>
            </td>
            <td class="text-center text-muted">{{ producto.stockMinimo }}</td>
            <td class="text-center">
              <span [class]="producto.diferencia < 0 ? 'text-danger fw-bold' : 'text-warning fw-bold'">
                {{ producto.diferencia }}
              </span>
            </td>
            <td class="text-center">
              <p-tag
                [value]="getEstadoText(producto.diferencia)"
                [styleClass]="getSeverityClass(producto.diferencia)">
              </p-tag>
            </td>
            <td class="text-end d-none d-xl-table-cell">{{ formatCurrency(producto.precioCompra) }}</td>
            <td class="text-end d-none d-xl-table-cell">{{ formatCurrency(producto.valorReposicion) }}</td>
            <td class="d-none d-lg-table-cell">
              <small class="text-muted">{{ producto.ubicacion }}</small>
            </td>
          </tr>
        </ng-template>

        <ng-template pTemplate="emptymessage">
          <tr>
            <td colspan="11" class="text-center py-5">
              <div class="d-flex flex-column align-items-center">
                <p-avatar icon="pi pi-inbox" styleClass="bg-light text-muted mb-3" size="xlarge"></p-avatar>
                <h6 class="text-muted mb-2">No se encontraron productos</h6>
                <small class="text-muted">No hay productos con stock bajo en este momento</small>
              </div>
            </td>
          </tr>
        </ng-template>
      </p-table>
    </ng-template>
  </p-card>


